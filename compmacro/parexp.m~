clear all;
clc;

alfa=0.3;
bet=0.95;
del=0.1;
gam=1;
rho=0.9;
sig=0.01;
th=[0.4;-0.4;-0.1;-0.5;-0.1;0.1];
T=1000;
tbar=floor(0.1*T);
tol=1e-6

ep=randn(1,T);

k(1) = 2.57;
z(1) = 0;

checkn=1;

while checkn>tol
for t=2:T
    z(t)=rho*z(t-1)+sig*ep(t);
end

for t=1:T
   Phi=exp(th(1)+th(2)*log(k(t))+th(3)*log(k(t))^2+th(4)*z(t)+th(5)*z(t)^2+th(5)*z(t)*log(k(t)));
   c(t)=Phi^(-1/gam);
   k(t+1)=exp(z(t))*k(t)^alfa+(1-del)*k(t)-c(t);
end

k(T+1)=[];

k=k';
c=c';
z=z';

for i=1:T
    y(i)=bet*(c(i)^alfa)*((alfa*k(i)^(alfa-1))*exp(z(i))+1-del);
end

y=y';

x=[[ones(T-tbar,1)],[log(k(tbar+1:T))],[log(k(tbar+1:T)).^2],[z(tbar+1:T)],[z(tbar+1:T).^2],[z(tbar+1:T).*log(k(tbar+1:T))]];

th1=x\log(y(tbar+1:T));

checkn=norm(th-th